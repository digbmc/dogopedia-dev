---
layout: bilingual
---

{% assign thisChapter = site.texts | where: "chapter-number", page.number %}
{% assign thisChapter-en = thisChapter | where: "language", "en" %}
{% for i in thisChapter-en %}
{% assign title_en = i.title %}
{% assign text_en = i.content %}
{% endfor %}
{% assign thisChapter-ru = thisChapter | where: "language", "ru" %}
{% for i in thisChapter-ru %}
{% assign title_ru = i.title %}
{% assign text_ru = i.content %}
{% endfor %}

<article class="narrative bilingual annotations-hidden" id="chapter-content">
  <div class="header">
    <h1 class="text-title" id="en-title">{{ page.number }}. {{ title_en }}</h1>
    <h1 class="text-title" id="ru-title">{{ page.number }}. {{ title_ru }}</h1>
    <h1 class="text-title" id="both-title">{{ page.number }}. {{ title_en }} / {{ title_ru }}</h1>
    <p class="byline">by {{ page.author }}</p>
    <p class="byline" id="translator">Translated by {{ page.translator }}</p>
  </div>

  <div class="main-content">
    <div class="text-container english" id="texts">
      <div id="en" markdown="1">
        {{ text_en }}
      </div>
      <div id="ru" markdown="1">
        {% capture annotated-text-ru %}
        {{ text_ru }}
        {% endcapture %}

        {% for annotation in site.data.comments-02_ru %}
            {% capture highlighted %}{{ annotation.highlighted }}{% endcapture %}
            {% capture suffix %}{{ annotation.suffix }}{% endcapture %}
            {% capture replaced-text %}{{ highlighted }}{{ suffix }}{% endcapture %}
            {% capture new-text %}<a class="annotation-link" href="#{{ annotation.Id }}" tabindex="-1">{{ annotation.highlighted }}</a>{{ suffix }}{% endcapture %}
            {% capture annotated-text-ru %}{{ annotated-text-ru | replace_first: replaced-text, new-text }}{% endcapture %}
        {% endfor %}
        
        {{ annotated-text-ru }}
      </div>
    </div>
  </div>
</article>

<div id="annotation-panel">
  {{ content }}
</div>